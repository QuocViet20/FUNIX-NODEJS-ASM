
<%- include('../includes/head.ejs') %>
<style>
  .pagination{
  text-align: center;
  margin-top: 2rem;
}
  .pagination a{
  text-decoration:none;
  color: #00695c;
  padding: 0 0.5rem;
  border: 1px solid #00695c;
  margin: 0 1rem;
}

.pagination a:hover,
.pagination a:active,
.pagination a.active{
  background: #00695c;
  color: aliceblue;
}
</style>
</head>

<body>
    <%- include('../includes/navigation.ejs') %>
    <main>
     
          <%  if(sessions.length>0) { %> 
            <div class="container">
                <h1 class="mt-2 d-flex justify-content-center text-uppercase">Quá trình làm việc</h1>
                <hr/>
                <div class="row ">
                    <div class="mt-2 pd-2 col-md-5  col-lg-6">
                        <div style="font-size:25px">Tên nhân viên: <%= staffInfo.name %></div>
                    
                        <div style="font-size:25px">Bộ phận: <%= staffInfo.department%></div>
                        <% if(adminName){%>
                          <div style="font-size:25px">Quản lý bộ phận: <%= adminName%></div>
                          <%}%>
                    </div>
                    <div class=" col-md-7 col-lg-6 d-flex align-items-end " style="padding:0 ;">
                        <form class="row mt-2 " action="/admin/staff/detailMonth" method="POST">
                           
                            <div class="col-auto mt-2">
                              <h4 style=" padding-left:5px;font-size:25px;" >Nhập tháng năm</h4>
                
                            </div>
                            <div class="col-auto">
                              <input type="hidden" class="form-control  mt-2 " style="margin-left: 5px;"  name="staffId" value="<%=staffInfo._id%>">
                              <input type="text" class="form-control  mt-2 " style="margin-left: 5px;"  name="month" placeholder="9/2022">
                            </div>
                            <div class="col-auto  mt-2">
                              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                              <button type="submit" class="btn btn-primary mb-3 " style="margin-right:5px ;">Tìm kiếm</button>
                            </div>
                          </form>
                        
                    </div>
                </div>
                <hr/>
                <h4 class="mt-2 d-flex justify-content-center text-uppercase" style="color:rgb(212, 83, 44) ;">Danh sách các lượt làm <%= salaryProper? salaryProper.monthString :''%></h4>
                <div class="mt-4 d-flex justify-content-center">
                    <table class="table table-hover table-bordered">
                        <thead>
                            <tr>
                              <th scope="col" class="text-center">Ngày</th>
                              <th scope="col" class="text-center">Bắt đầu</th>
                              <th scope="col" class="text-center">Kết thúc</th>
                              <th scope="col" class="text-center">Nơi làm việc</th>
                              <th scope="col" class="text-center">Tổng giờ làm</th>
                              <!-- <th scope="col">Giờ làm thêm</th> -->
                              <th scope="col" class="text-center">Xóa</th>
                              <th scope="col" class="text-center">Xác nhận</th>
                            </tr>
                          </thead>
                       
                          <tbody>
                            <%
                            sessions.forEach(session=> { %>

                              <tr>
                                <td scope="row" class="text-center"><%= session.checkIn.getDate()
                                    .toString()
                                    .concat(" / " + (session.checkIn.getMonth()+1).toString()+"/"+session.checkIn.getFullYear()) %></td>
                                <td class="text-center"> <%= session.checkIn.getHours().toString().concat(":").concat(session.checkIn.getMinutes()>=10?session.checkIn.getMinutes().toString():"0"+session.checkIn.getMinutes() ) %></td>
                                <td class="text-center"> <% if(session.checkOut) {%> <%=session.checkOut.getHours().toString().concat(":").concat(session.checkOut.getMinutes()>=10?session.checkOut.getMinutes().toString():"0"+session.checkOut.getMinutes() )%><%} else{%>--<%}  %></td>
                                <td class="text-center"><%= session.workPlace %></td>
                                <td class="text-center"><%if(session.checkOut){%> <%=((session.checkOut-session.checkIn)/3600000).toFixed(1) %> <%} else{%><%}  %></td>
                                <!-- <td><% if(((session.checkOut-session.checkIn)/3600000)>8) {%><%= (((session.checkOut-session.checkIn)/3600000)-8).toFixed(2) %> <%} else{%> 0.00<%}  %></td> -->
                              <% if(session.confirm ||   !session.checkOut){%>
                               <td></td>
                                <%}else{%>
                                  
                                  
                                    <td> <form class="text-center" action="/admin/delete-session" method="POST">
                                      <input type="hidden" name="sessionId" value="<%=session._id%>">
                                      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                       <button type="submit" class="btn btn-danger">Xóa</button>
                                    </form></td> 
                                   
                                  
                                  <%}
                              %>
                              <%
                              if(session.checkOut){%>

                                <td> <form class="text-center" action="/admin/confirm-session" method="POST">
                                  <input type="hidden" name="sessionId" value="<%=session._id%>">
                                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                   <button type="submit" class="btn btn-success "><%=session.confirm?'Đã xác nhận':'Xác nhận'%></button>
                                </form></td>
                                <%}else{%>
                                  <td></td><%}

                              %>
                            </tr>
                              <%}
                              )
                           %>
                        
                         
                          </tbody>
                      </table>
                    </div>
                    <%if(currentPage){%>
                      <section class="pagination">
                        <% if(currentPage!==1 && previousPage!==1) { %>
                            <a href="/admin/staff/session/<%=staffInfo._id%>?page=1">1</a>
                        <%}%>
                    
                        <% if(hasPreviousPage) {%>
                            <a href="/admin/staff/session/<%=staffInfo._id%>?page=<%= previousPage %>"><%= previousPage %></a> 
                            <%}
                        %>
                    
                        <a href="/admin/staff/session/<%=staffInfo._id%>?page=<%= currentPage %>" class="active"><%= currentPage %></a>
                    
                        <% if(hasNextPage) { %>
                            <a href="/admin/staff/session/<%=staffInfo._id%>?page=<%= nextPage %>"><%= nextPage %></a> 
                            <%}
                        %>
                    
                        <% if(nextPage!==lastPage && lastPage!==currentPage) {%>
                            <a href="/admin/staff/session/<%=staffInfo._id%>?page=<%= lastPage %>"><%= lastPage %></a> 
                            <%}
                        %>
                    </section>
                      <%}
                    %>   
                    <%
                    if(salaryProper){%>
                      <h5 class="mt-2 d-flex justify-content-center text-uppercase">Bảng lương tháng: <%= salaryProper.monthString%></h5>
                      <div class="mt-4 ">
                                <h6>Tổng giờ làm thêm trong tháng: overtime= <%= salaryProper.overtime %> (h)</h6>
                                <h6>Tổng giờ làm thiếu trong tháng: số giờ làm thiếu= <%= salaryProper.subtraction %> (h)</h6>
                                <h6>Hệ số lương tháng của bạn: salaryScale= <%= salaryProper.salaryScale%></h6>
                                <h5 style="color: red ;">Lương tháng của bạn: <%= salaryProper.salary %> (đồng)</h5>
                                <p> Công thức tính lương: <%= salaryProper.formula %></p>
                        </div>
                      
                      <%}
                    %>  
                    <hr/>
                <h4 class="mt-4 d-flex justify-content-center text-uppercase" style="color:rgb(212, 83, 44) ;">Danh sách đăng ký nghỉ phép</h4>
                <% if(dayOffs.length>0){%>
                  <div class="mt-4 d-flex justify-content-center">
                    <table class="table table-hover table-bordered">
                        <thead>
                            <tr>
                              <th scope="col">Ngày</th>
                              <th scope="col">Số giờ</th>
                              <th scope="col">Lý do</th>
                              <th scope="col">Còn lại</th>
                            </tr>
                          </thead>
                       
                          <tbody>
                            <%
                            dayOffs.forEach(d=> { %>

                              <tr>
                               <td><%= d.dateOff %></td>
                                <td><%= d.quantityDays %></td>
                                <td><%= d.reason %></td>
                                <td> <%= Math.floor(staffInfo.annualLeave.leffDayOff) %> ngày <%= (staffInfo.annualLeave.leffDayOff*8) -Math.floor(staffInfo.annualLeave.leffDayOff)*8 %> giờ</td>
                               
                              </tr>
                              <%}
                              )
                           %>
                        
                         
                          </tbody>
                      </table>
                </div>
                  <%}else{%>
                    <h3>Bạn chưa đăng ký ngày nghỉ nào</h3>
                    <%}
                %>
                 
               
               
            </div>
            <%} else {
                %> <div class="container">

                  <h1 class="mt-4"> Không có phiên làm việc !!!</h1>
                </div>
                <%
            }
        %>
     
        
    </main>
    <%- include('../includes/end.ejs') %>